/*
 * file: app_card.c 
 * author: hwz
 * date: 2025.5.26
 * description: This file contains functions for Simplified EMV interface process and  minimal design
 * version: 1.0 
*/
#include "lvgl.h"
#include "app_lvgl.h"

#include "app_card_payment.h"
#include "app_dsp.h"
#include "dsp_emv.h"
#include "pub_tools.h"

#define SALE_ONLINE_REQUEST_URL "https://www.dspread.com"

extern unsigned char waitflag;


int card_read_method =-1;  // 1-ICC  2-NFC
int isBeepPlay = 0;
bool offlinepinflag = false;

APPEMVINFO gEmvInfo;


extern int  button_count;
extern int  button_length;  
extern int  button_len;

extern bool gTransThreadFlag;
extern char cardpayamount[64];

static const char *EMV_RETURN_CODE[] =
{
	"APP_RC_COMPLETED",
	"APP_RC_TERMINAL",
	"APP_RC_CANCEL",
	"APP_RC_EMV_DENAIL",
	"APP_RC_EMV_GAC2_DENAIL",
	"APP_RC_NFC_NOT_ALLOW",
	"APP_RC_EMV_APP_BLOCK",
	"APP_RC_EMV_APP_SEE_PHONE",
	"APP_RC_EMV_TRANS_TRY_ANOTHER_INTERFACE",
	"APP_RC_EMV_TRANS_GPO_NOT_SUPPORT",
	"APP_RC_FALL_BACK",
	"APP_RC_EMV_CARD_BLOCK",
	"APP_RC_CARD_NOT_SUPPORT",
	"APP_RC_NFC_RETAP_TIMEOUT",
	"APP_RC_NFC_RETAP_CANCEL",
	"APP_RC_NFC_TERMINAL",
	"APP_RC_NFC_DOUBLETAP_DENAIL",
	"APP_RC_NFC_MULTI_CARD",
	"APP_RC_NFC_TRY_AGAIN",
	"APP_RC_TRANS_REVERSEL",
	"APP_RC_NUMS",
};

unsigned int Fild55[] =
{
	0x9F26,0x9F27,0x9F10,0x9F37,0x9F36,0x95,0x9A,0x9B,0x9C,0x9F02,0x5F2A,0x82,
	0x9F1A,0x9F03,0x9F33,0x9F34,0x9F35,0x9F1E,0x84,0x9F09,0x9F41,0x9F63,0x9F25,0x9F39,0x9F6C,
	0x9F6E,0x9F07,0x9F21,0x9F4E,0x99,0	
};
/*
 * function: Function to get payment brand based on AID
 * parameters:
 *   - aid: aid name
 *   - paybrand: card brand
 * return value: 
 */
void get_payment_brand(char* aid ,char *paybrand) 
{
    if (strncmp(aid, "A000000003",10) == 0) 
        strcpy(paybrand, "VISA");  
    else if (strncmp(aid, "A000000004",10) == 0)
		
		strcpy(paybrand, "MasterCard"); 
    else if (strncmp(aid, "A000000025",10) == 0) 
        strcpy(paybrand, "ExpressPay");
    else if (strncmp(aid, "A000000065",10) == 0) 
        strcpy(paybrand, "JCB J/Speedy");
    else if (strncmp(aid, "A000000658",10) == 0) 
        strcpy(paybrand,"Discover Contactless");
    else if (strncmp(aid, "A000000333",10) == 0||strncmp(aid, "A000000790",10) == 0)  	
        strcpy(paybrand, "UnionPay");
	else if (strncmp(aid, "A000000524",10) == 0) 
        strcpy(paybrand,"RuPay");
    else 
        strcpy(paybrand, "Unknown");
	return;  
}



static int _GetPanFromTrack(char *pszTrack2, char *pszPan, int *pnPanLen)
{
 	int i = 0;
	//API_LOG_DEBUG("pszTrack2 =[%s]",pszTrack2);
 	if (0 != pszTrack2[0])
 	{
 	 	for (i = 0; i < 37; i++)
  		{
   			if (pszTrack2[i] == 'D')
   			{
   				 break;
  		    }
  		}
  		if (i == 37)
 		{
   			return -1;
  		}
  		if (i > 20 || i < 12)
 		{
   			return -1;
  		}
 	 	else
  		{
   			memcpy(pszPan, pszTrack2, i);
   			*pnPanLen = i;
  		}
  		return 0;
 	}
 	return -1;
}
int ApiSecGetOfflinePin(unsigned char *pszPinBlock, unsigned int uiTimeoutMs, unsigned char PinFormat)
{
	int ret = 0;
	unsigned int Format = (PinFormat << 16);
	unsigned int time = 0;
	unsigned char pinDisplay[12+1] = {0};
	unsigned char pin[12+1] = {0};
	unsigned char disflag = 1;
	unsigned char cardtype=0;
	unsigned int lenMod;
	unsigned char mod[256];
	unsigned char cType = 0x01;
	u32 lenE;
	u8 e[256];
	u32 lenRand; 
	u8 rand[256];
	unsigned char card_data[100]="0000000000000000000";
	unsigned char data[100] = {0};
	unsigned char data_len = 0;
	unsigned char pin_len = 0;

	if (PinFormat > 4)
	{
		return -3;
		// return SDK_API_PARAM_ERR;
	}
	cardtype=1;
    ret = OsSecSetPinpadOfflineModeParam(2,cardtype,  4, 12, uiTimeoutMs, lenMod, &mod, lenE,&e, lenRand, &rand);
	if (ret != 0)
	{
		return -3;
	}
	ret = OsSecSetPinblockParam(Format, 1, 10, 4, 12, uiTimeoutMs, 19, card_data, 0, 0, NULL);
	__TRACEASCDATA__("pin api_sec_setPinblock_param:%d\n", ret);
	if (ret != 0)
	{
		return -3;
	}
	
	//OsSysMsleep(10);
	time = OsSysTick();
	while (1)
	{


		if ((OsSysTick() - time) >= uiTimeoutMs*1000)
		{
			return -3;
		}

		if (disflag)
		{

			if(cType == 0x01)
				app_lvgl_inputShow("Offline Plain PIN", pin, 0, 0, 0,true);
			else
				app_lvgl_inputShow("Offline Encipher PIN", pin, 0, 0, 0, true);
		}
		
		ret = OsSecGetPinblockStatus(data, &data_len);
		if ((ret == 0) && (data_len == 1))
		{
			switch (data[0])
			{
			case CANCEL:
				// return SDK_API_USER_CANCEL;
				time=OsSysTick();
				return RETURN_CANCEL;
			case CLEAR:
				time=OsSysTick();
				memset(pin, 0x00, sizeof(pin));
				memset(pinDisplay, 0x00, sizeof(pinDisplay));
				pin_len = 0;
				break;
			case ENTER:
				if (pin_len == 0)
				{
					// return SDK_API_NO_PIN;
					return 0;
				}
				break;
			case '*':
				time=OsSysTick();
				pin[pin_len] = '*';
				pinDisplay[pin_len] = '*';
				pin_len++;
				break;
			default:
				memset(pinDisplay + pin_len, 126, 12 - pin_len);
				break;
			}
		}
		else if (ret == 0)
		{
			memcpy(pszPinBlock, data+1, data[0]);
			return data[0];
		}
		else
		{
			return -3;
		}
		OsSysMsleep(100);
	}

	return ret;
}


int EMV_InputOfflinePasswd(char *pszPin)
{
	u32  startTick; 
	int i   = -1;
	char buf[32]={0};
	char pin[32]={0};
	int iRet=0;
	char gb2312hex1[128] = { 0 };
	unsigned char* str1 = (unsigned char *)"Please input pin";
	for(i=0;i<strlen((char *)str1);i++ ){
		sprintf(gb2312hex1 + 2*i,"%02x",str1[i]);
	}
	if(card_read_method == 1 || (atof(cardpayamount) >5000 && card_read_method == 2))
	{
	 	API_LOG_DEBUG("Start EMV_InputOfflinePasswd entering password......"); 	
		
		OsAudioTtsPlay(gb2312hex1, 1);//
	 	//app_audio_play("Please_input_pin.mp3");
		OsSysMsleep(500);

		waitflag=1;
		iRet=ApiSecGetOfflinePin(pin,30,2);
		waitflag=0;
		if(iRet > 0)
		{
			strcpy(pszPin,pin);
			inputpinpassward = false;
		}
	}
	offlinepinflag = true;
	return iRet;

}


/***********************************************
��  �ܣ��û���������PIN
��  ��: pan[IN]:        --�û�PAN
		pszPin[out]:    --����8�ֽ�pinblock
����ֵ��RETURN_SUCC     --�ɹ�
		RETURN_BYPASSPIN--�û�������PIN�Ĳ���
		RETURN_CANCEL   --����ȡ��(�û�����ȡ������ʱ��û����)
**********************************************/
int ApiSecGetPinBlockNew(unsigned char *card_data, unsigned char *pszPinBlock, unsigned int uiTimeoutMs, unsigned char PinFormat)
{

	// unsigned char pwdlen= 0;
	int ret = 0;
	// unsigned int	uiRemainTime = 0;
	unsigned char amount[32] = {0};
	unsigned int Format = (PinFormat << 16);
	unsigned int time = 0;
	unsigned int timeout = 0;
	unsigned char data[100] = {0};
	unsigned char data_len = 0;
	unsigned char pin_len = 0;
	unsigned char pin[100] = {0};
	unsigned char pinDisplay[9] = {0};
	unsigned char disflag = 1;

	time = OsSysTick();

	if (PinFormat > 4)
	{
		return -3;
	}
	ret = OsSecSetPinblockParam(Format, 1, 10, 4, 12, uiTimeoutMs, strlen(card_data), card_data, 0, 0, NULL);
	__TRACEASCDATA__("pin api_sec_setPinblock_param:%d\n", ret);
	if (ret != 0)
	{
		return -1;
	}
	
	while (1)
	{

		if ((OsSysTick() - time) >= uiTimeoutMs*1000)
		{
			return -3;
		}

		if (disflag)
		{
			app_lvgl_inputShow("Input Password", pin, 0, 0, 0, true);
		}
		ret = OsSecGetPinblockStatus(data, &data_len);
		if ((ret == 0) && (data_len == 1))
		{
			switch (data[0])
			{
			case CANCEL:
				time=OsSysTick();
				return RETURN_CANCEL;
			case CLEAR:
				time=OsSysTick();
				memset(pin, 0x00, sizeof(pin));
				memset(pinDisplay, 0x00, sizeof(pinDisplay));
				pin_len = 0;
				break;
			case ENTER:
				if (pin_len == 0)
				{
					return 0; //PIN BYPASS
				}
				break;
			case '*':
				time=OsSysTick();
				pin[pin_len] = '*';
				pinDisplay[pin_len] = '*';
				pin_len++;
				break;
			default:
				memset(pinDisplay + pin_len, 126, 12 - pin_len);
				break;
			}
		}
		else if (ret == 0)
		{
			memcpy(pszPinBlock, data, data_len);
			return data_len;
		}
		else
		{
			return -1;
		}
		OsSysMsleep(10);
	}

	return -1;
}


int EMV_InputOnlinePasswd(unsigned char *pan, char *pszPin)
{
	int ret=0;
	char pinFormat = 0;
	if (card_read_method == 2)
	{
		app_beep_play();
		isBeepPlay = 1;
	}
	__TRACEASCDATA__("pan : %s", pan);
	app_dsp_play(0,"/ext/audio/english/dsp_pinconfirm.wav","Please input your pin", 1);
	waitflag=1;
    ret = ApiSecGetPinBlockNew(pan, pszPin, 30, 2);
	waitflag=0;

	__TRACEASCDATA__("ApiSecGetPinBlockNew : %d", ret);
	inputpinpassward=true;	
	 if(ret == 0)
	 { 
	     return 0;  //PIN BYPASS
	 }
	 else if(ret==RETURN_CANCEL)
	 {
		 return RETURN_CANCEL;
	 }
	 else if(ret > 0)
	 {
		 return ret; 
	 }
	 return RETURN_FAIL;

}

int EMV_InputAmount(char Type, char *Amount)
{
    char amt[13] = {0};  
    int index = 0;

 
    if (cardpayamount == NULL || strlen(cardpayamount) == 0) 
    {
        API_LOG_DEBUG("Invalid input: cardpayamount is NULL or empty");
        return RETURN_FAIL;
    }

   
    for (int i = 0; i < strlen(cardpayamount) && index < sizeof(amt) - 1; i++) 
    {
        if (cardpayamount[i] == '.') 
            continue; 
        
        if (!isdigit(cardpayamount[i])) 
        {
            API_LOG_DEBUG("Invalid input: cardpayamount contains non-digit characters");
            return RETURN_FAIL;
        }
        amt[index++] = cardpayamount[i];  
    }

    
    if (index > 12) 
	{
        API_LOG_DEBUG("Invalid input: cardpayamount exceeds maximum allowed digits");
        return RETURN_FAIL;
    }

    sprintf(Amount, "%012s", amt);  

    API_LOG_DEBUG("Formatted amount (Amount)=[%s]", Amount);
    return RETURN_SUCC;
}

void Sys_InitFlash();


/*
 * function: Function to EMV init
 * parameters:
 * return value: 0:succ other:fail
 */


/*
 * function: Function to form Type OPen CradReader
 * parameters:
 *   - type: CHECK_INSERTIC AND CHECK_RFCARD
 * return value: 0:succ other:fail
 */

int Pub_EMVOpenCard(unsigned char type)
{
    int ret=0;

    if(type & CHECK_INSERTIC)
    {
        ret = App_IccCardOpen(0);
    }
 
    if(type & CHECK_RFCARD)
    {
		ret = App_PiccCardOpen();
    }
  
    return ret;
}
int Pub_EMVCloseCard(unsigned char type)
{
    int ret=0;

    if(type & CHECK_INSERTIC)
    {
		ret = App_ICCardClose(IC_CARD_NO);
    }
 
    if(type & CHECK_RFCARD)
    {
		ret = App_PiccCardClose();
    }
  
    return ret;
}

/*
 * function: Function to form Type Check CradReader
 * parameters:
 *   - type: CHECK_INSERTIC AND CHECK_RFCARD
 * return value: 0:succ other:fail
 */
int Pub_EMVCheckCard(unsigned char type)
{
    int ret=0;

    if(type & CHECK_INSERTIC)
    {
     	if(App_ICCardPresent(0) == 1)
     	{
     	    
			App_PiccCardClose();
			API_LOG_DEBUG("NFC Close");
			return 1;
     	}
    }
 
    if(type & CHECK_RFCARD)
    {
        if (App_PiccCardPresent() == 1)
        {
            App_ICCardClose(IC_CARD_NO);
			API_LOG_DEBUG("IC Card Close");
			return 2;
        }
    }
    return ret;

}
/*
 * function: Function to form TagList to pack EMV Data
 * parameters:
 *   - TagList:need pack Tag list
 *   - outData:pack complete data
 * return value: 0:succ other:fail
 */

int Pub_EMVPackTLVData(char *outData,unsigned int *TagList)
{

    return 0;

}
/*
 * function: Function to emv flow before online 
 * parameters:
 *   - card_read_method:1-connect 2-connectless
 *   - cardNum: card num
 *   - emvInfo: emv data struct
 * return value: 0:succ other:fail
 */
struct App {
    int counter;
    char lable[ 5 ][ 32 ];
	char preferredName[5][32];
};
static struct App LocalMultiApp;

void EmvL2_SetDefaultAidAndCapk(){
    u8 temp[1024]= {0};
	char *aidList[] = {
		"9F0610000000000000000000000000000000005F2A0201705F3601029F01060012345678909F150212349F160F4243544553543132333435363738009F1A0201709F1C084E4C2D47503733309F1E0838333230314943439F3303E0F8C89F3501219F3901059F40057000B0A0019F4E04616263649F5301529F811701019F811801009F814301019F814501019F814701009F830301019F822301019F822401019F822501019F822601019F824801019F822001019F821C01019F872501017F154C7F16239F821801069F8208069999999999999F8209060000250000009F820A060000000004007F16239F8218010B9F8208069999999999999F8209060000250000009F820A0600000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607A0000000041010DF0101009F090200029F1B04000000009F1D086C7A8000000000009F5C0D7A45123EE59C7F40DF810D01029F6D0200019F7E009F8125039F37049F812701009F812801009F812904000000009F812A05FC50BC80009F812B0500000000009F812C05FC50BC8000DF6000DF6200DF6300DF810800DF810900DF810A00DF810C0102DF810D0102DF81170120DF81180160DF81190108DF811A039F6A04DF811B01B0DF811C0100DF811D0100DF811E0110DF811F0108DF812005F45084800CDF8121050000000000DF812205F45084800CDF812306000000000000DF812406003000000000DF812506003000000000DF812606000025000000DF812C01007F110C9C0120DF812105FFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607A0000000043060DF0101009F090200029F1B04000000009F1D084C7A8000000000009F5C0800000000000000009F6D0200019F7E009F8125039F37049F812701009F812801009F812904000000009F812A05FC50BC80009F812B0500000000009F812C05FC50BC8000DF6000DF6200DF6300DF810800DF810900DF810A00DF810C0102DF810D00DF81170120DF81180140DF81190108DF811A039F6A04DF811B01A0DF811C0100DF811D0100DF811E0110DF811F0108DF812005F45084800CDF8121050000800000DF812205F45084800CDF812306000000000000DF812406003000000000DF812506003000000000DF812606000025000000DF812C010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607A0000000031010DF0101009F090200019F1B04000000009F5301529F660436C0C0009F8125039F37049F812701009F812801009F812904000000009F812A05F06004A8009F812B050810A800009F812C05F06854F8009F92810004050100009F92810101009F8208060030000000009F8209060000250001009F820A0600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607A0000000032010DF0101009F090200019F1B04000000009F660436C0C0009F8125039F37049F812701009F812801009F812904000000009F812A05F06004A8009F812B050810A800009F812C05F06854F8009F92810004050100009F92810101009F8208060030000000009F8209060000250001009F820A060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607A0000000033010DF0101009F090200019F1B04000000009F660436C0C0009F8125039F37049F812701009F812801009F812904000000009F812A05F06004A8009F812B050810A800009F812C05F06854F8009F92810004050100009F92810101009F8208060030000000009F8209060000250001009F820A060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0606A00000002501DF0101009F090200019F1B04000000009F6D01C09F6E04D8E040009F8125039F37049F812701009F812801009F812904000000009F812A05DC50FC98009F812B0500100000009F812C05DE00FC98009F8208060030000000009F8209060000250000009F820A060000000000009F821801E09F8240010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607A0000001523010DF0101009F090200029F1B04000000009F66043680C0009F8125039F37049F812701009F812801009F812904000000009F812A05D84000A8009F812B0500100000009F812C05D84004F8009F8208060030000000009F8209060000250000009F820A060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607AAA000000100019F2A0122DF0101009F1B04000000009F090200969F1D054C008000009F8125039F37049F812701009F812801009F812904000000009F812A05DC4000A8009F812B0500100000009F812C05DC4004F8009F824505F45084800C9F82460500000000009F824705F45084800C9F930901909F9311309F029F039F26829F369F279F109F1A955F2A9A9C9F379F35579F34845F345AC79F339F739F779F459F199F249F259F6E9F9312028C579F93130582959F77849F93010524044001999F930201D79F9314039F37049F824301009F8244060000000000009F8208060030000000009F8209060000250000009F820A06000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607AAA000000100029F2A0122DF0101009F1B04000000009F090200969F1D054C008000009F8125039F37049F812701009F812801009F812904000000009F812A05DC4000A8009F812B0500100000009F812C05DC4004F8009F824505F45084800C9F82460500000000009F824705F45084800C9F930901909F9311309F029F039F26829F369F279F109F1A955F2A9A9C9F379F35579F34845F345AC79F339F739F779F459F199F249F259F6E9F9312028C579F93130582959F77849F93010524044001999F930201D79F9314039F37049F824301009F8244060000000000009F8208060030000000009F8209060000250000009F820A06000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607A0000003330101DF0101009F0902008C9F1B04000000009F1E0838333230314943439F6604B60040009F8125039F37049F812701009F812801009F812904000000009F812A05D84000A8009F812B0500008000009F812C05D84004F8009F92810004050100009F92810101009F92810A02FE009F92810D069999999999999F92810E060000000300019F92810F060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0607A0000005241010DF0101009F090200649F1B04000000009F8125039F37049F812701009F812801009F812904000000009F812A05D84000A8009F812B0500100000009F812C05D84004F800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
	};
	int aidListCount = sizeof(aidList) / sizeof(aidList[0]);

	char *capkList[] = {
		"9F0605A0000000039F220107DF028190A89F25A56FA6DA258C8CA8B40427D927B4A1EB4D7EA326BBB12F97DED70AE5E4480FC9C5E8A972177110A1CC318D06D2F8F5C4844AC5FA79A4DC470BB11ED635699C17081B90F1B984F12E92C1C529276D8AF8EC7F28492097D8CD5BECEA16FE4088F6CFAB4A1B42328A1B996F9278B0B7E3311CA5EF856C2F888474B83612A82E4E00D0CD4069A6783140433D50725FDF0314B4BC56CC4E88324932CBC643D6898F6FE593B172DF0403000003DF050420311217DF060101DF070101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000039F220108DF0281B0D9FD6ED75D51D0E30664BD157023EAA1FFA871E4DA65672B863D255E81E137A51DE4F72BCC9E44ACE12127F87E263D3AF9DD9CF35CA4A7B01E907000BA85D24954C2FCA3074825DDD4C0C8F186CB020F683E02F2DEAD3969133F06F7845166ACEB57CA0FC2603445469811D293BFEFBAFAB57631B3DD91E796BF850A25012F1AE38F05AA5C4D6D03B1DC2E568612785938BBC9B3CD3A910C1DA55A5A9218ACE0F7A21287752682F15832A678D6E1ED0BDF031420D213126955DE205ADC2FD2822BD22DE21CF9A8DF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000039F220109DF0281F89D912248DE0A4E39C1A7DDE3F6D2588992C1A4095AFBD1824D1BA74847F2BC4926D2EFD904B4B54954CD189A54C5D1179654F8F9B0D2AB5F0357EB642FEDA95D3912C6576945FAB897E7062CAA44A4AA06B8FE6E3DBA18AF6AE3738E30429EE9BE03427C9D64F695FA8CAB4BFE376853EA34AD1D76BFCAD15908C077FFE6DC5521ECEF5D278A96E26F57359FFAEDA19434B937F1AD999DC5C41EB11935B44C18100E857F431A4A5A6BB65114F174C2D7B59FDF237D6BB1DD0916E644D709DED56481477C75D95CDD68254615F7740EC07F330AC5D67BCD75BF23D28A140826C026DBDE971A37CD3EF9B8DF644AC385010501EFC6509D7A41DF03141FF80A40173F52D7D27E0F26A146A1C8CCB29046DF0403000003DF050420311222DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000049F220104DF028190A6DA428387A502D7DDFB7A74D3F412BE762627197B25435B7A81716A700157DDD06F7CC99D6CA28C2470527E2C03616B9C59217357C2674F583B3BA5C7DCF2838692D023E3562420B4615C439CA97C44DC9A249CFCE7B3BFB22F68228C3AF13329AA4A613CF8DD853502373D62E49AB256D2BC17120E54AEDCED6D96A4287ACC5C04677D4A5A320DB8BEE2F775E5FEC5DF0314381A035DA58B482EE2AF75F4C3F2CA469BA4AA6CDF0403000003DF050420311217DF060101DF070101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000049F220105DF0281B0B8048ABC30C90D976336543E3FD7091C8FE4800DF820ED55E7E94813ED00555B573FECA3D84AF6131A651D66CFF4284FB13B635EDD0EE40176D8BF04B7FD1C7BACF9AC7327DFAA8AA72D10DB3B8E70B2DDD811CB4196525EA386ACC33C0D9D4575916469C4E4F53E8E1C912CC618CB22DDE7C3568E90022E6BBA770202E4522A2DD623D180E215BD1D1507FE3DC90CA310D27B3EFCCD8F83DE3052CAD1E48938C68D095AAC91B5F37E28BB49EC7ED597DF0314EBFA0D5D06D8CE702DA3EAE890701D45E274C845DF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000049F220106DF0281F8CB26FC830B43785B2BCE37C81ED334622F9622F4C89AAE641046B2353433883F307FB7C974162DA72F7A4EC75D9D657336865B8D3023D3D645667625C9A07A6B7A137CF0C64198AE38FC238006FB2603F41F4F3BB9DA1347270F2F5D8C606E420958C5F7D50A71DE30142F70DE468889B5E3A08695B938A50FC980393A9CBCE44AD2D64F630BB33AD3F5F5FD495D31F37818C1D94071342E07F1BEC2194F6035BA5DED3936500EB82DFDA6E8AFB655B1EF3D0D7EBF86B66DD9F29F6B1D324FE8B26CE38AB2013DD13F611E7A594D675C4432350EA244CC34F3873CBA06592987A1D7E852ADC22EF5A2EE28132031E48F74037E3B34AB747FDF0314F910A1504D5FFB793D94F3B500765E1ABCAD72D9DF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", "9F0605A0000000049F2201F1DF0281B0A0DCF4BDE19C3546B4B6F0414D174DDE294AABBB828C5A834D73AAE27C99B0B053A90278007239B6459FF0BBCD7B4B9C6C50AC02CE91368DA1BD21AAEADBC65347337D89B68F5C99A09D05BE02DD1F8C5BA20E2F13FB2A27C41D3F85CAD5CF6668E75851EC66EDBF98851FD4E42C44C1D59F5984703B27D5B9F21B8FA0D93279FBBF69E090642909C9EA27F898959541AA6757F5F624104F6E1D3A9532F2A6E51515AEAD1B43B3D7835088A2FAFA7BE7DF0314D8E68DA167AB5A85D8C3D55ECB9B0517A1A5B4BBDF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000259F220102DF0270AF4B8D230FDFCB1538E975795A1DB40C396A5359FAA31AE095CB522A5C82E7FFFB252860EC2833EC3D4A665F133DD934EE1148D81E2B7E03F92995DDF7EB7C90A75AB98E69C92EC91A533B21E1C4918B43AFED5780DE13A32BBD37EBC384FA3DD1A453E327C56024DACAEA74AA052C4DDF031433F5B0344943048237EC89B275A95569718AEE20DF0403000003DF050420311223DF060101DF070101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", "9F0605A0000000259F220103DF028180B0C2C6E2A6386933CD17C239496BF48C57E389164F2A96BFF133439AE8A77B20498BD4DC6959AB0C2D05D0723AF3668901937B674E5A2FA92DDD5E78EA9D75D79620173CC269B35F463B3D4AAFF2794F92E6C7A3FB95325D8AB95960C3066BE548087BCB6CE12688144A8B4A66228AE4659C634C99E36011584C095082A3A3E3DF03148708A3E3BBC1BB0BE73EBD8D19D4E5D20166BF6CDF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000259F220104DF0260D0F543F03F2517133EF2BA4A1104486758630DCFE3A883C77B4E4844E39A9BD6360D23E6644E1E071F196DDF2E4A68B4A3D93D14268D7240F6A14F0D714C17827D279D192E88931AF7300727AE9DA80A3F0E366AEBA61778171737989E1EE309DF0314FDD7139EC7E0C33167FD61AD3CADBD68D66E91C5DF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000259F22010EDF028190AA94A8C6DAD24F9BA56A27C09B01020819568B81A026BE9FD0A3416CA9A71166ED5084ED91CED47DD457DB7E6CBCD53E560BC5DF48ABC380993B6D549F5196CFA77DFB20A0296188E969A2772E8C4141665F8BB2516BA2C7B5FC91F8DA04E8D512EB0F6411516FB86FC021CE7E969DA94D33937909A53A57F907C40C22009DA7532CB3BE509AE173B39AD6A01BA5BB85DF0314A7266ABAE64B42A3668851191D49856E17F8FBCDDF0403000003DF050420311223DF060101DF070101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000259F22010FDF0281B0C8D5AC27A5E1FB89978C7C6479AF993AB3800EB243996FBB2AE26B67B23AC482C4B746005A51AFA7D2D83E894F591A2357B30F85B85627FF15DA12290F70F05766552BA11AD34B7109FA49DE29DCB0109670875A17EA95549E92347B948AA1F045756DE56B707E3863E59A6CBE99C1272EF65FB66CBB4CFF070F36029DD76218B21242645B51CA752AF37E70BE1A84FF31079DC0048E928883EC4FADD497A719385C2BBBEBC5A66AA5E5655D18034EC5DF0314A73472B3AB557493A9BC2179CC8014053B12BAB4DF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000259F220110DF0281F8CF98DFEDB3D3727965EE7797723355E0751C81D2D3DF4D18EBAB9FB9D49F38C8C4A826B99DC9DEA3F01043D4BF22AC3550E2962A59639B1332156422F788B9C16D40135EFD1BA94147750575E636B6EBC618734C91C1D1BF3EDC2A46A43901668E0FFC136774080E888044F6A1E65DC9AAA8928DACBEB0DB55EA3514686C6A732CEF55EE27CF877F110652694A0E3484C855D882AE191674E25C296205BBB599455176FDD7BBC549F27BA5FE35336F7E29E68D783973199436633C67EE5A680F05160ED12D1665EC83D1997F10FD05BBDBF9433E8F797AEE3E9F02A34228ACE927ABE62B8B9281AD08D3DF5C7379685045D7BA5FCDE58637DF0314C729CF2FD262394ABC4CC173506502446AA9B9FDDF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000259F220165DF028190E53EB41F839DDFB474F272CD0CBE373D5468EB3F50F39C95BDF4D39FA82B98DABC9476B6EA350C0DCE1CD92075D8C44D1E57283190F96B3537D9E632C461815EBD2BAF36891DF6BFB1D30FA0B752C43DCA0257D35DFF4CCFC98F84198D5152EC61D7B5F74BD09383BD0E2AA42298FFB02F0D79ADB70D72243EE537F75536A8A8DF962582E9E6812F3A0BE02A4365400DDF0314894C5D08D4EA28BB79DC46CEAD998B877322F416DF0403000003DF050420311223DF060101DF070101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000259F2201C9DF0281B0B362DB5733C15B8797B8ECEE55CB1A371F760E0BEDD3715BB270424FD4EA26062C38C3F4AAA3732A83D36EA8E9602F6683EECC6BAFF63DD2D49014BDE4D6D603CD744206B05B4BAD0C64C63AB3976B5C8CAAF8539549F5921C0B700D5B0F83C4E7E946068BAAAB5463544DB18C63801118F2182EFCC8A1E85E53C2A7AE839A5C6A3CABE73762B70D170AB64AFC6CA482944902611FB0061E09A67ACB77E493D998A0CCF93D81A4F6C0DC6B7DF22E62DBDF03148E8DFF443D78CD91DE88821D70C98F0638E51E49DF0403000003DF050420311216DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000259F2201CADF0281F8C23ECBD7119F479C2EE546C123A585D697A7D10B55C2D28BEF0D299C01DC65420A03FE5227ECDECB8025FBC86EEBC1935298C1753AB849936749719591758C315FA150400789BB14FADD6EAE2AD617DA38163199D1BAD5D3F8F6A7A20AEF420ADFE2404D30B219359C6A4952565CCCA6F11EC5BE564B49B0EA5BF5B3DC8C5C6401208D0029C3957A8C5922CBDE39D3A564C6DEBB6BD2AEF91FC27BB3D3892BEB9646DCE2E1EF8581EFFA712158AAEC541C0BBB4B3E279D7DA54E45A0ACC3570E712C9F7CDF985CFAFD382AE13A3B214A9E8E1E71AB1EA707895112ABC3A97D0FCB0AE2EE5C85492B6CFD54885CDD6337E895CC70FB3255E3DF03146BDA32B1AA171444C7E8F88075A74FBFE845765FDF0403000003DF050420311216DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000659F220109DF0281B0B362DB5733C15B8797B8ECEE55CB1A371F760E0BEDD3715BB270424FD4EA26062C38C3F4AAA3732A83D36EA8E9602F6683EECC6BAFF63DD2D49014BDE4D6D603CD744206B05B4BAD0C64C63AB3976B5C8CAAF8539549F5921C0B700D5B0F83C4E7E946068BAAAB5463544DB18C63801118F2182EFCC8A1E85E53C2A7AE839A5C6A3CABE73762B70D170AB64AFC6CA482944902611FB0061E09A67ACB77E493D998A0CCF93D81A4F6C0DC6B7DF22E62DBDF03144410C6D51C2F83ADFD92528FA6E38A32DF048D0ADF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000659F220110DF02819099B63464EE0B4957E4FD23BF923D12B61469B8FFF8814346B2ED6A780F8988EA9CF0433BC1E655F05EFA66D0C98098F25B659D7A25B8478A36E489760D071F54CDF7416948ED733D816349DA2AADDA227EE45936203CBF628CD033AABA5E5A6E4AE37FBACB4611B4113ED427529C636F6C3304F8ABDD6D9AD660516AE87F7F2DDF1D2FA44C164727E56BBC9BA23C0285DF0314C75E5210CBE6E8F0594A0F1911B07418CADB5BABDF0403000003DF050420311223DF060101DF070101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000659F220112DF0281B0A2583AA40746E3A63C22478F576D1EFC5FB046135A6FC739E82B55035F71B09BEB566EDB9968DD649B94B6DEDC033899884E908C27BE1CD291E5436F762553297763DAA3B890D778C0F01E3344CECDFB3BA70D7E055B8C760D0179A403D6B55F2B3B083912B183ADB7927441BED3395A199EEFE0DEBD1F5FC3264033DA856F4A8B93916885BD42F9C1F456AAB8CFA83AC574833EB5E87BB9D4C006A4B5346BD9E17E139AB6552D9C58BC041195336485DF0314D9FD62C9DD4E6DE7741E9A17FB1FF2C5DB948BCBDF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000659F220114DF0281F8AEED55B9EE00E1ECEB045F61D2DA9A66AB637B43FB5CDBDB22A2FBB25BE061E937E38244EE5132F530144A3F268907D8FD648863F5A96FED7E42089E93457ADC0E1BC89C58A0DB72675FBC47FEE9FF33C16ADE6D341936B06B6A6F5EF6F66A4EDD981DF75DA8399C3053F430ECA342437C23AF423A211AC9F58EAF09B0F837DE9D86C7109DB1646561AA5AF0289AF5514AC64BC2D9D36A179BB8A7971E2BFA03A9E4B847FD3D63524D43A0E8003547B94A8A75E519DF3177D0A60BC0B4BAB1EA59A2CBB4D2D62354E926E9C7D3BE4181E81BA60F8285A896D17DA8C3242481B6C405769A39D547C74ED9FF95A70A796046B5EFF36682DC29DF0314C0D15F6CD957E491DB56DCDD1CA87A03EBE06B7BDF0403000003DF050420311223DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000001529F220101DF0281808D1727AB9DC852453193EA0810B110F2A3FD304BE258338AC2650FA2A040FA10301EA53DF18FD9F40F55C44FE0EE7C7223BC649B8F9328925707776CB86F3AC37D1B22300D0083B49350E09ABB4B62A96363B01E4180E158EADDD6878E85A6C9D56509BF68F0400AFFBC441DDCCDAF9163C4AACEB2C3E1EC13699D23CDA9D3ADDF0314E0C2C1EA411DB24EC3E76A9403F0B7B6F406F398DF0403000003DF050420311222DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000001529F220103DF028190BF321241BDBF3585FFF2ACB89772EBD18F2C872159EAA4BC179FB03A1B850A1A758FA2C6849F48D4C4FF47E02A575FC13E8EB77AC37135030C5600369B5567D3A7AAF02015115E987E6BE566B4B4CC03A4E2B16CD9051667C2CD0EEF4D76D27A6F745E8BBEB45498ED8C30E2616DB4DBDA4BAF8D71990CDC22A8A387ACB21DD88E2CC27962B31FBD786BBB55F9E0B041DF0314CA1E9099327F0B786D8583EC2F27E57189503A57DF0403000003DF050420311222DF060101DF070101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000001529F220104DF0281B08EEEC0D6D3857FD558285E49B623B109E6774E06E9476FE1B2FB273685B5A235E955810ADDB5CDCC2CB6E1A97A07089D7FDE0A548BDC622145CA2DE3C73D6B14F284B3DC1FA056FC0FB2818BCD7C852F0C97963169F01483CE1A63F0BF899D412AB67C5BBDC8B4F6FB9ABB57E95125363DBD8F5EBAA9B74ADB93202050341833DEE8E38D28BD175C83A6EA720C262682BEABEA8E955FE67BD9C2EFF7CB9A9F45DD5BDA4A1EEFB148BC44FFF68D9329FDDF031417F971CAF6B708E5B9165331FBA91593D0C0BF66DF0403000003DF050420311222DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000001529F220105DF0281F8E1200E9F4428EB71A526D6BB44C957F18F27B20BACE978061CCEF23532DBEBFAF654A149701C14E6A2A7C2ECAC4C92135BE3E9258331DDB0967C3D1D375B996F25B77811CCCC06A153B4CE6990A51A0258EA8437EDBEB701CB1F335993E3F48458BC1194BAD29BF683D5F3ECB984E31B7B9D2F6D947B39DEDE0279EE45B47F2F3D4EEEF93F9261F8F5A571AFBFB569C150370A78F6683D687CB677777B2E7ABEFCFC8F5F93501736997E8310EE0FD87AFAC5DA772BA277F88B44459FCA563555017CD0D66771437F8B6608AA1A665F88D846403E4C41AFEEDB9729C2B2511CFE228B50C1B152B2A60BBF61D8913E086210023A3AA499E423DF031412BCD407B6E627A750FDF629EE8C2C9CC7BA636ADF0403000003DF050420311222DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000039F220192DF0281B0996AF56F569187D09293C14810450ED8EE3357397B18A2458EFAA92DA3B6DF6514EC060195318FD43BE9B8F0CC669E3F844057CBDDF8BDA191BB64473BC8DC9A730DB8F6B4EDE3924186FFD9B8C7735789C23A36BA0B8AF65372EB57EA5D89E7D14E9C7B6B557460F10885DA16AC923F15AF3758F0F03EBD3C5C2C949CBA306DB44E6A2C076C5F67E281D7EF56785DC4D75945E491F01918800A9E2DC66F60080566CE0DAF8D17EAD46AD8E30A247C9FDF0314429C954A3859CEF91295F663C963E582ED6EB253DF0403000003DF050420311222DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000005249F220103DF028190E703A908FFAE3730F82E550869A294C1FF1DA25F2B53D2C8BB18F770DAD505135D03D5EC8EE3926550051C3D4857F6FEDB882C2889E0B25F389F78741F2931A92D45D3A47E62810D3253653AB0AB3570C35DFD08D3167B6DB42ED28F765186F4287CDAF9D9BAD20BCE2C4ECFECDD218E50F1FCC718878882F3934A6FEB502CFCAD615A2B2E279A0868DDA9489DFA9CD9DF03144B93D1E1F57CFA16970501F17D3E06411043F1D5DF0403000003DF050420311222DF060101DF070101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000005249F220104DF028180A1F5E1C9BD8650BD43AB6EE56B891EF7459C0A24FA84F9127D1A6C79D4930F6DB1852E2510F18B61CD354DB83A356BD190B88AB8DF04284D02A4204A7B6CB7C5551977A9B36379CA3DE1A08E69F301C95CC1C20506959275F41723DD5D2925290579E5A95B0DF6323FC8E9273D6F849198C4996209166D9BFC973C361CC826E1DF03146F843CE765B9144CE1A6BFEA46BC37B65081CE7FDF0403000003DF050420311222DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000005249F220105DF0281F8C04E80180369898AAEF6EE7741EDED25239D765301614B5B41A008CA3009358D626D828BC5F1B1E04A2DC1367101266905D262003BE747FD231C9B0011F2F2B21BA8E4C0F4CA5E93ED9DBB2E92ABC450576A4EB59AD00DCA59C8BF3230E4B19D43452871C6215D837663310DF43CAEA1B9B08C1F500AF1B550F62E18D70EEE9E9475321BCD1799AB193E0BC849DACE892A0E6A1F42FE0786DB30345AE1A0E7E4C4B71640E03BFD2832C491A7D83F3B4EF4D388CDDBB748C2FD1D9D4A9BF52FC856CBA088D4B274846002C23CDA722C5CFF3B1F8218A1843B0426474BDC92F2F5E31FBF321CC17480AD069DF55381F2E601D5CBA7B871253FDF03147081DF2A0C36360F24C122C574F0AD2E57893DD2DF0403000003DF050420311222DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000005249F220106DF0281F89D8A75B36BCBDF250B87615A46F6EA35DE35226EEAB7B473D7DC0A28B5DF075C83B2775F23337E6CEE36CCFE3A6568C9C822D6DE81299565A829348E03D479B631BB18A2429A8590C597F446A3CEA3BE2E822106F43DFBB981EC0F1121919CB35F85DBA3355C5E7FF35F2B221FD65EDBEA41F23A7A109FBBC4A774A756D89B593B199E1E9DA9A99217D4BF31F67CDA8C4E1B81FA2A377C83B5D1CD6AF1F1880448CFF48D3A4ADBBC7FBD730061508A6EA8FDFC5BD66A2E94E33B83F81E0E56CF1C9473E4426EE435F9E80136760D8F4AD946805B03A67C55361582F5AD8F40404392FA4CB4F5C2BAF6E26857A1D60941E3D055ACD9AC0BEFDF0314E98F4134E1949A9A054E4679AC9A7EC83969E209DF0403000003DF050420311222DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		"9F0605A0000000049F2201EFDF0281F8A191CB87473F29349B5D60A88B3EAEE0973AA6F1A082F358D849FDDFF9C091F899EDA9792CAF09EF28F5D22404B88A2293EEBBC1949C43BEA4D60CFD879A1539544E09E0F09F60F065B2BF2A13ECC705F3D468B9D33AE77AD9D3F19CA40F23DCF5EB7C04DC8F69EBA565B1EBCB4686CD274785530FF6F6E9EE43AA43FDB02CE00DAEC15C7B8FD6A9B394BABA419D3F6DC85E16569BE8E76989688EFEA2DF22FF7D35C043338DEAA982A02B866DE5328519EBBCD6F03CDD686673847F84DB651AB86C28CF1462562C577B853564A290C8556D818531268D25CC98A4CC6A0BDFFFDA2DCCA3A94C998559E307FDDF915006D9A987B07DDAEB3BDF031421766EBB0EE122AFB65D7845B73DB46BAB65427ADF0403000003DF050420311222DF060101DF07010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
	};
	int capkListCount = sizeof(capkList) / sizeof(capkList[0]);


    int curAidCount = Emv_GetAidTotalNum();
    API_LOG_DEBUG("curAidCount = %d \n",curAidCount);
    if(curAidCount <= 0){
		Emv_ClrAIDFile();
		for(int i = 0;i<aidListCount;i++){
			memset(temp,0x0,sizeof(temp));
			Util_Asc2Bcd(aidList[i],temp, strlen(aidList[i]));
			if(Emv_PARAM_InputAIDData(temp,strlen(aidList[i])/2) <0){
				API_LOG_DEBUG("Set AID Failed \n");
				return;
			}
		}       
    }

	int curCapkCount = Emv_GetCapkTotalNum();
    API_LOG_DEBUG("curCapkCount = %d \n",curCapkCount);
    if(curCapkCount <= 0){
        Emv_ClrCAPKFile();
		for(int i = 0;i<capkListCount;i++){
			memset(temp,0x0,sizeof(temp));
			Util_Asc2Bcd(capkList[i], temp,  strlen(capkList[i]));
			if(Emv_PARAM_InputCAPKData(temp,strlen(capkList[i])/2) <0){
				API_LOG_DEBUG("Set CAPK Failed \n");
				return;
			}
		}
    }

	curAidCount = Emv_GetAidTotalNum();
	curCapkCount = Emv_GetCapkTotalNum();
	API_LOG_DEBUG("aidListCount = %d  capkListCount = %d \n",aidListCount,capkListCount);
	API_LOG_DEBUG("curAidCount = %d  curCapkCount = %d \n",curAidCount,curCapkCount);
}
void unpackAppsName( int counter, AidCandidate_t *pList ) 
{
    int i;
    memset(&LocalMultiApp, 0x00, sizeof( LocalMultiApp ) );
    LocalMultiApp.counter = counter;
    for(i =0;i<counter;i++)
    {
        if(i == 5)
            break;
        memcpy(LocalMultiApp.lable[i],pList[i]._lable,pList[i]._lable_len);
        memcpy(LocalMultiApp.preferredName[i],pList[i]._preferred_name,pList[i]._preferred_name_len);
    }
}

//Multiple application selection return value>=0. Return selected AID serial number -1 failed
int aidSelect(AidCandidate_t *pList, int listNum){

	unpackAppsName(listNum,pList);

    u32  button;
	u32 startTick;
	char paybrand[64] = {0};
	int  buttonnum;
	char* aidList[64] ={0};
	memset(paybrand,0,sizeof(paybrand));
    if(listNum ==0)
    {
        API_LOG_DEBUG("AIDList is NULL");
    	return  -1;
    }
	app_lvgl_clearClientBg();
	for(int i = 0; i < LocalMultiApp.counter; i++) 
	{
		aidList[i] = _malloc(33); 
        memset(aidList[i], 0, 33);
		memset(paybrand, 0, sizeof(paybrand));
		if (strlen(LocalMultiApp.lable[i]) == 0)
			strcpy(paybrand, LocalMultiApp.preferredName[i]);
		else
			strcpy(paybrand, LocalMultiApp.lable[i]);
		sprintf(aidList[i], "%d.%s", i + 1, paybrand);
    }
	app_lvgl_menuShow("EMV_UserSelectApp", aidList, LocalMultiApp.counter);
	startTick = OsSysTick();
	waitflag=1;
	while(1)
	{
		OsSysMsleep(100);
		if( OsSysTick()-startTick > 30000 )
			break;
		button = OsKeypadGetKey();
		buttonnum = button -'0';
		if((button >= DIGITAL1 && button <= DIGITAL7) &&((buttonnum >= 1 && buttonnum <=  LocalMultiApp.counter)))
		{
			for(int i=0; i< LocalMultiApp.counter && i<64; i++)
    			_free(aidList[i]);
			API_LOG_DEBUG("AIDList =[%d]",buttonnum);
			waitflag=0;
			return buttonnum -1;
		}
	}
	for(int i=0; i< LocalMultiApp.counter; i++)
    _free(aidList[i]);
	waitflag=0;

	return -1;
}
//Card number confirmation return value 0 Confirm-1 failed
int confirmCardInfo(char *pan,int len){
	memcpy(gEmvInfo.szPan,pan,len);
    return 0;
}

int Emv_GetCardInfo(){
	return 0;
}

int Pack_EmvData(unsigned char* pEmvData,int *pEmvDataLen)
{
	u8 buf[512];
	u32 totalLength;
	u32 tags[] = {EMVTAG_AC, EMVTAG_CID, EMVTAG_IAD, EMVTAG_RND_NUM,
						EMVTAG_ATC, EMVTAG_TVR, EMVTAG_TXN_DATE, EMVTAG_TXN_TYPE,
						EMVTAG_AMOUNT, EMVTAG_CURRENCY, EMVTAG_AIP, EMVTAG_COUNTRY_CODE,
						EMVTAG_OTHER_AMOUNT, EMVTAG_TERM_CAP, EMVTAG_CVM, EMVTAG_TERM_TYPE,
						EMVTAG_IFD, EMVTAG_DF, EMVTAG_APP_VER, EMVTAG_TXN_SN,
						EMVTAG_CARD_ID, EMVTAG_ARC, EMVTAG_EC_AUTH_CODE};
	totalLength = Emv_FetchData(tags, PR_ARRAY_SIZE(tags), buf, PR_ARRAY_SIZE(buf));

	nBcd2Asc(buf,totalLength*2,pEmvData,0);
	//memcpy(pEmvData,buf,totalLength);
	*pEmvDataLen = totalLength*2;
	
	return 0;
}

int onlineProcess(EmvOnlineData_t* pOnlineData){

    return app_dsp_cardPay(SALE_ONLINE_REQUEST_URL,&gEmvInfo,pOnlineData);
}

int certConfirm(unsigned char type, unsigned char *pcon, unsigned char len){
    return 1;
}

int emv_process_disp(EmvKernelDisp type)
{

	switch (type)
	{
	case EMV_DISP_READING_CARD:
		app_lvgl_mainShow(DSP_WAITTING_IMG, 100, 100, "Card Reading", LV_COLOR_DSP_BLUE);
		break;
	case EMV_DISP_SEE_PHONE:
		app_lvgl_mainShow(DSP_WAITTING_IMG, 100, 100, "Please check your phone", LV_COLOR_DSP_BLUE);
		break;
	case EMV_DISP_REMOVE_CARD:
		app_lvgl_mainShow(DSP_WAITTING_IMG, 100, 100, "Please remov your card", LV_COLOR_DSP_BLUE);
		break;
	case EMV_DISP_NFC_RETAP:
		app_lvgl_card_retap();
		break;
	default:
		break;
	}
	return 0;
} 

int inputPasswd(int type, char *pszPin)
{
	API_LOG_DEBUG("Start entering password......"); 
	int ret;
	if(type == EMV_ONLINEPIN_INPUT)
	{
		ret = EMV_InputOnlinePasswd(gEmvInfo.szPan,pszPin);
	}
	else
	{
		ret = EMV_InputOfflinePasswd(pszPin);
	}

	return ret;
}
static void Initialize_EMV_CallBackFun(EmvCallBack_t *pcallbackfun)
{
	pcallbackfun->EMV_AidSelect = aidSelect;
	pcallbackfun->EMV_ConfirmCardInfo = confirmCardInfo;
	pcallbackfun->EMV_InputPasswd = inputPasswd;
	pcallbackfun->EMV_CertConfirm = certConfirm;
	pcallbackfun->EMV_ProcessDisp = emv_process_disp;
	pcallbackfun->EMV_OnlineProcess = onlineProcess;
	pcallbackfun->EMV_AfterReadRecord = NULL;
	pcallbackfun->EMV_AfterSelectApp = NULL;
	pcallbackfun->EMV_SetKernelId = NULL;
}

void EmvL2_Init(){
    EmvCallBack_t t_callbackfun;

    Initialize_EMV_CallBackFun(&t_callbackfun);
    Emv_KernelInit(t_callbackfun);
}

int EmvL2_Proc(EmvTransParams_t emvTransParams){
    EMV_L2_Return nEmvRet = APP_RC_START;
	int ret = -1;

    nEmvRet = Emv_Process(emvTransParams);
	if(emvTransParams.icc_type == CONTACTLESS_ICC && nEmvRet == APP_RC_COMPLETED)
	{
		// do contactless trans online request
		EmvOnlineData_t emvOnlineData;
		memset(&emvOnlineData,0,sizeof(EmvOnlineData_t));
		ret = onlineProcess(&emvOnlineData);
		if(ret == 0)
		{
			if(memcmp(emvOnlineData.iccResponse,"00",2) == 0 && emvOnlineData.ackdatalen > 0)
				ret = Emv_SetOnlineResult(KERNEL_POLL_CTL_MODE,&emvOnlineData);
		}

		if(ret == 0)
			nEmvRet = APP_RC_COMPLETED;
		else
			nEmvRet = APP_RC_TERMINAL;
	}
    return nEmvRet;
}
int Pub_EmvProcess(int card_read_method)
{
	API_LOG_DEBUG( "EMV_Process...");
	int ret;
	int pnPanLen;
	char timeStr[16];
	char newamount[13];

	memset(&gEmvInfo,0,sizeof(gEmvInfo));

    EmvTransParams_t emvTransParams;
    int nEmvRet;
    char szCardno[20] = {0};
	inputpinpassward=false;	

    memset(&emvTransParams,0x0,sizeof(EmvTransParams_t));
    emvTransParams.trans_type = EMV_L2_SALE;  
    app_reviseAmount(cardpayamount, newamount);
    memcpy((char *)emvTransParams.trans_amount,newamount,12);

	pub_getRtcTime(timeStr);
	Pub_AscToBcd(timeStr, (char*)emvTransParams.trans_time, 14);
    emvTransParams.force_online_enable = 0; 

	if(card_read_method == 1 ){
        emvTransParams.icc_type = CONTACT_ICC;
    }else if(card_read_method == 2){
		isBeepPlay = 0;
        emvTransParams.icc_type = CONTACTLESS_ICC;
    }
    else{
        return -1;
    }

	if(card_read_method == 2 && isBeepPlay == 0)
		app_beep_play();

    nEmvRet = EmvL2_Proc(emvTransParams);
	if(nEmvRet < APP_RC_NUMS && nEmvRet != -1)
		API_LOG_DEBUG( "emv kernel recode [%s]",EMV_RETURN_CODE[nEmvRet]);
	else
		API_LOG_DEBUG( "emv kernel recode [%d]",nEmvRet);   
    return nEmvRet;
}

int Pub_EMVProcessApp(int card_read_method,char *cardNum,APPEMVINFO *emvInfo)
{
	API_LOG_DEBUG( "EMV_Process...");
	int ret;
	int pnPanLen;
	char timeStr[16];
	char newamount[13];

	memset(&gEmvInfo,0,sizeof(gEmvInfo));

    EmvTransParams_t emvTransParams;
    int nEmvRet;
    char szCardno[20] = {0};
	inputpinpassward=false;	

    memset(&emvTransParams,0x0,sizeof(EmvTransParams_t));
    emvTransParams.trans_type = EMV_L2_SALE;  
    app_reviseAmount(cardpayamount, newamount);
    memcpy((char *)emvTransParams.trans_amount,newamount,12);

	pub_getRtcTime(timeStr);
	Pub_AscToBcd(timeStr, (char*)emvTransParams.trans_time, 14);
    emvTransParams.force_online_enable = 0; 

	if(card_read_method == 1 ){
        emvTransParams.icc_type = CONTACT_ICC;
    }else if(card_read_method == 2){
		isBeepPlay = 0;
        emvTransParams.icc_type = CONTACTLESS_ICC;
    }
    else{
        return -1;
    }

	if(card_read_method == 2 && isBeepPlay == 0)
		app_beep_play();
	if(card_read_method == 2)
	{
    	App_ICCardClose(IC_CARD_NO);
	}

    nEmvRet = EmvL2_Proc(emvTransParams);
	if(nEmvRet < APP_RC_NUMS && nEmvRet != -1)
		API_LOG_DEBUG( "emv kernel recode [%s]",EMV_RETURN_CODE[nEmvRet]);
	else
		API_LOG_DEBUG( "emv kernel recode [%d]",nEmvRet);   
    return nEmvRet;
}
